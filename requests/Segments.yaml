SegmentAction:
  post:
    summary: Segment - Bulk Action
    description: |
      Request a bulk action for a segment
    tags:
      - Segments
    parameters:
      - name: bucket
        in: path
        required: true
        schema:
          $ref: 'shared.yaml#/schemas/bucket'
      - name: uid
        in: path
        required: true
        schema:
          $ref: 'shared.yaml#/schemas/uid'
      - name: action
        in: query
        required: true
        schema:
          type: string
          enum:
            - add_tag
            - change-status
            - debug
            - draft-templated-email
            - join-group
            - raise-authorised-xero-invoice
            - raise-draft-xero-invoice
            - raise-submitted-xero-invoice
            - remove_tag
            - send-email-to-fixed-address
            - send-json-webhook
            - send-templated-email
            - send-templated-email-request-acknowledgement
            - send-templated-in-app-message
            - send-templated-in-app-message-request-acknowledgement
            - send-templated-sms
            - send-webhook
            - set-single-field
            - set-single-field-on-last-membership
      - name: value
        in: query
        required: true
        description: |
          The value to be used in the action.
          This is dependent on the action.
        schema:
          type: string
      - name: description
        in: query
        required: true
        description: |
          A description of the action to be performed.
          This is used in the audit trail.
        schema:
          type: string
      - name: field
        in: query
        required: false
        description: |
          The field to be used in the action.
          This is dependent on the action and required by some actions.
        schema:
          type: string


    responses:
      '200':
        description: |
          Successful operation
          The URI of the `action` record and the URI of the `sheep_event`
          that will track the progress of this action.
        content:
          application/json:
            schema:
              $ref: '#/responses/action'
      '400':
        description: a standard error message
      '401':
        description: Authentication error

SegmentConfig:
  get:
    summary: Segment - Config
    description: |
      The config for a segment
    tags:
      - Segments
    parameters:
      $ref: 'shared.yaml#/parameters/split_uri'
    responses:
      '200':
        description: |
          The segment configuration
        content:
          application/json:
            schema:
              $ref: '#/responses/config'
      '400':
        description: a standard error message
      '401':
        description: Authentication error

SegmentCount:
  get:
    summary: Segment - Count
    description: |
      The count and description of the segment
    tags:
      - Segments
    parameters:
      $ref: 'shared.yaml#/parameters/split_uri'
    responses:
      '200':
        description: |
          The count and description of the segment
        content:
          application/json:
            schema:
              $ref: '#/responses/count'
      '400':
        description: a standard error message
      '401':
        description: Authentication error

SegmentLookup:
  get:
    summary: Segment - Lookup
    description: |
      The lookup for a segment
    tags:
      - Segments
    parameters:
      - name: bucket
        in: path
        required: true
        schema:
          $ref: 'shared.yaml#/schemas/bucket'
      - name: uid
        in: path
        required: true
        schema:
          $ref: 'shared.yaml#/schemas/uid'
      - name: q
        in: query
        required: false
        schema:
          $ref: 'shared.yaml#/schemas/uid'
    responses:
      '200':
        description: |
          A list of segments matching the search terms
        content:
          application/json:
            schema:
              $ref: '#/responses/lookup'
      '400':
        description: a standard error message
      '401':
        description: Authentication error

responses:
  action:
    type: object
    properties:
      action:
        $ref: 'shared.yaml#/schemas/uri'
      description:
        type: string
      field:
        type: string
      segment_uri:
        $ref: 'shared.yaml#/schemas/uri'
      sheep_event:
        $ref: 'shared.yaml#/schemas/uri'
      status:
        type: string
        example: "created"
      user_uri:
        $ref: 'shared.yaml#/schemas/user_uri'
      value:
        type: string
      verbose:
        type: boolean
        example: false

  config:
    type: object
    properties:
      mapping:
        type: object
        properties:
          collection:
            type: string
          contact_field: {}
          contact_search_fields:
            type: array
            items: {}
          field_list:
            type: array
            items:
              type: string
          fields:
            type: array
            items:
              type: object
              properties:
                field:
                  type: string
                form_type:
                  type: string
                label:
                  type: string
                style:
                  type: string
          join_orgs:
            type: boolean
          join_people:
            type: boolean
          name:
            type: string
          name_singular:
            type: string
          prefix:
            type: string
          search_fields:
            type: array
            items:
              type: string
          search_placeholder:
            type: string
          sort_by:
            type: array
            items:
              type: array
          unique_field:
            type: string
          use_mapreduce:
            type: boolean
      resource_type:
        type: string
      segment:
        $ref: 'shared.yaml#/schemas/uri'
      segment_type:
        type: string
        enum:
          - dynamic
          - static
          - hybrid
          - auxiliary
      user_groups:
        type: array
        items: {}
      user_groups_for_display:
        type: array
        items: {}
      user_interface:
        type: object
        properties:
          can_bypass_gdpr:
            type: array
            items:
              type: boolean
          can_create_segment:
            type: boolean
          can_delete_segment:
            type: boolean
          can_edit_segment:
            type: boolean
          can_restore_segment:
            type: boolean
      view_context:
        type: array
        items:
          type: string

  count:
    type: object
    properties:
      count:
        type: integer
      description:
        type: string
      segment:
        $ref: 'shared.yaml#/schemas/uri'

  lookup:
    type: array
    items:
      type: object
      properties:
        display_value:
          $ref: 'shared.yaml#/schemas/display_value'
        id:
          $ref: 'shared.yaml#/schemas/uri'
        label:
          type: string
        text:
          type: string
        uri:
          $ref: 'shared.yaml#/schemas/uri'
        value:
          $ref: 'shared.yaml#/schemas/uri'
